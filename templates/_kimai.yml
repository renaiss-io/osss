# TODO: fix kimai SSO
{{- define "kimai.yml" -}}
kimai:
  saml:
    provider: keycloak
    activate: true
    title: Login with keycloak
    mapping:
        - { saml: $Email, kimai: email }
        - { saml: $FirstName $LastName, kimai: alias }
    roles:
        resetOnLogin: true
        attribute: Roles
        mapping:
            - { saml: Admins, kimai: ROLE_ADMIN }
            - { saml: Management, kimai: ROLE_TEAMLEAD }
    connection:
        idp:
            entityId: 'http://keycloak.{{ .Values.global.domain }}/realms/osss'
            singleSignOnService:
                url: 'http://keycloak.{{ .Values.global.domain }}/realms/osss/protocol/saml'
                binding: 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect'
            x509cert: 'MIIClzCCAX8CBgGOKO44SjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDARvc3NzMB4XDTI0MDMxMDE1MTMwNFoXDTM0MDMxMDE1MTQ0NFowDzENMAsGA1UEAwwEb3NzczCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAIpUoDq3C3CQRCNAy26kMJP7UkAL9P6fFHEYPdFg+zFxVMSezJCk0kZH/pLil3gURTECqQywZ+aks746hAxSquUJZ4WldgSbUbnhiizTvu0eb/94IcY/eUTmUzn2CgrMO1UMrOupoaFht7fhs0z42KmAHj24Goe9FdaWM/H1Yd5r8AeA0NrKYSo4oUkLdBo+Hv8w1JMkOoRtXPMJC6ewQ0mZ0XVM2U5g49wlC4E4PuacKMoytSx28qXh8jzKJmHoEhhNAGARZ7iTGtzBp9soaioI0+Stbqx3+ZSnx0ym1lHJzhokaQErSREKGpPjPfFPopQbQ5QXcJQmjvVDS3otU5ECAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAhoDRyxiv5kkqSkuasKA9Gnot7UkKRK2FoPTyxZEFAVffUwsG8Hi3moS6rpmn94X0kZZsbA9bE5FIUJ9A1X8Q3Kb/V0btfgAeFVn9nC9pJEXJgAPaIxXbqTtrqosDM4b/Et27GyrS1kSZH+IEcf8G/Qkuhd9Dqz+6FzP8VRwO5WTPseUNJxkEmp8bsf5xQiBjF6UbxMGC3QVX1JDq7hJtLj9cCbUAEA24SFNmWx0sp6GBntvUT7tdju61QGwBomMVjxltQ367BoCrfotythqKc0Hx402qy3nzqmDk7fQEploFC1R9w67BzZJdc1IFM0lPE3I53FUf7cPgTWGvhToJNQ=='
        sp:
            entityId: 'kimai'
            assertionConsumerService:
                url: 'http://kimai.{{ .Values.global.domain }}/auth/saml/acs'
                binding: 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST'
            singleLogoutService:
                url: 'http://kimai.{{ .Values.global.domain }}/auth/saml/logout'
                binding: 'urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect'
        strict: true
        debug: true
        security:
            nameIdEncrypted: false
            authnRequestsSigned: false
            logoutRequestSigned: false
            logoutResponseSigned: false
            wantMessagesSigned: false
            wantAssertionsSigned: false
            wantNameIdEncrypted: false
            requestedAuthnContext: true
            signMetadata: false
            wantXMLValidation: true
            signatureAlgorithm: 'http://www.w3.org/2001/04/xmldsig-more#rsa-sha256'
            digestAlgorithm: 'http://www.w3.org/2001/04/xmlenc#sha256'
        contactPerson:
            technical:
                givenName: 'Kimai Admin'
                emailAddress: 'kimai-tech@example.com'
            support:
                givenName: 'Kimai Support'
                emailAddress: 'kimai-support@example.com'
        organization:
            en:
                name: 'Kimai'
                displayname: 'Kimai'
                url: 'https://www.kimai.org'
{{- end -}}
